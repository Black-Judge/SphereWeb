//$(function() {
	
	function PlayVideo()
	{
		if (isMobileDevice()) {
			//document.getElementById("my-iframe1").src = "https://www.youtube.com/embed/objg0K55_-I?controls=1&mute=0&showinfo=0&rel=0&autoplay=1&loop=1&playlist=objg0K55_-I";
			//document.getElementById("my-iframe-name3").innerHTML = "L2CW.RU";
			
			//document.getElementById("my-iframe1").src = "https://player.twitch.tv/?channel=roman_hazard&parent=l2cw.ru";
			//document.getElementById("my-iframe-name3").innerHTML = "roman_hazard";
			
			document.getElementById("my-iframe1").src = "https://www.youtube.com/embed/ojjGHMQ2oW8?controls=1&mute=1&showinfo=0&rel=0&autoplay=1&loop=1&playlist=ojjGHMQ2oW8";
			document.getElementById("my-iframe-name3").innerHTML = "DuneCat";

		}
		else
		{
			//document.getElementById("my-iframe1").src = "https://www.youtube.com/embed/objg0K55_-I?controls=1&mute=1&showinfo=0&rel=0&autoplay=1&loop=1&playlist=objg0K55_-I";
			//document.getElementById("my-iframe-name3").innerHTML = "L2CW.RU";
			
			//document.getElementById("my-iframe1").src = "https://player.twitch.tv/?channel=roman_hazard&parent=l2cw.ru";
			//document.getElementById("my-iframe-name3").innerHTML = "roman_hazard";
			
			document.getElementById("my-iframe1").src = "https://www.youtube.com/embed/ojjGHMQ2oW8?controls=1&mute=1&showinfo=0&rel=0&autoplay=1&loop=1&playlist=ojjGHMQ2oW8";
			document.getElementById("my-iframe-name3").innerHTML = "DuneCat";
		}
		
		$('.video_old').hide();
		$('.play-btn').hide();
	}
	
	function isMobileDevice() {
		var check = false;
		(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
		return check;
	};
	
	
	
	var forum = "https://forum.l2cw.ru/";
	var shopScript = [];

	var winnersInterval = 10*1000;
	var showLoading = [];
	showLoading[0] = true;
	showLoading[1] = true;
	showLoading[2] = true;
	showLoading[3] = true;
	showLoading[4] = true;
	showLoading[5] = true;
	
	showLoading[6] = true;
	showLoading[7] = true;
	showLoading[8] = true;
	
	
	var isfirst = true;
	var online1 = -1;
	var online2 = -1;


	var refreshIntervalId;

	
	/*
	window.onhashchange = function()
	{ 
		if(refreshIntervalId)
		{
			clearInterval(refreshIntervalId)
		}
		var lastStats = $('#lastStats')
		if (lastStats.find(".oflo").length != 0)
		{
			lastStats.find(".oflo").remove()
		}
		
		showLoading = true
		loadlastStats()
	}*/
	
	window.onload = function()
	{
		//document.getElementById("my-iframe1").src = "https://www.youtube.com/embed/objg0K55_-I?controls=1&mute=1&showinfo=0&rel=0&autoplay=1&loop=1&playlist=objg0K55_-I";
		//$('.video_old').hide();
		//$('.play-btn').hide();
		
		if (isMobileDevice()) {
			// код для мобильных устройств
		} else {
			// код для обычных устройств
			PlayVideo();
		}
		alert("TEST");
		
		showLoading[0] = true
		showLoading[1] = true
		showLoading[2] = true
		showLoading[3] = true
		showLoading[4] = true
		showLoading[5] = true
		
		showLoading[6] = true
		showLoading[7] = true
		showLoading[8] = true
		loadlastStatsMain()
		$('.forumHomeA').attr("href", forum);
		
		
		//setInterval(function()
		/*
		setTimeout(function()
		{
			/ *$('#anims').addClass('anim grn');
			setTimeout(function()
			{
				$('#anims').removeClass('anim grn');
			},1000);* /
			$('#anims').removeClass('grn');
		},10000);*/
	}
	
	function PagePrev()
	{
		var page = 1;
		var pagehtml = $('.pagestat>span');
		if(pagehtml.length != 0)
		{
			var parsed = parseInt(pagehtml.html());
			if (isNaN(parsed) || parsed<2)
			{
				page = 1;
				pagehtml.html(page);
			}
			else
			{
				page = parsed;
				pagehtml.html(page-1);
			}
			//page = pagehtml
			loadlastStats(6);
		}
	}
	
	function PageNext()
	{
		var page = 1;
		var pagehtml = $('.pagestat>span');
		if(pagehtml.length != 0)
		{
			var parsed = parseInt(pagehtml.html());
			if (isNaN(parsed) || parsed<1)
			{
				page = 1;
				pagehtml.html(page);
			}
			else
			{
				page = parsed;
				pagehtml.html(page+1);
			}
			//page = pagehtml
			loadlastStats(6);
		}
	}
	
	function PageNews(self,id)
	{
		var href = $(self).attr("href");
		
		var page = id;
		var pagehtml = $('.pagenews>span');
		if(pagehtml.length != 0)
		{
			var parsed = parseInt(pagehtml.html());
			if (isNaN(parsed) || isNaN(page) || parsed<1 || page<1)
			{
				page = 1;
				pagehtml.html(page);
			}
			else
			{
				page = id;
				pagehtml.html(page);
			}
			
			switch (href)
			{
				case "#news":
				case "#newsall":
				{
					 //$(".content").promise().done(function() {
						var header = $("header");
						$('html, body').animate({
						scrollTop: (header.offset().top+header.outerHeight())-180
						}, {
							duration: 400,   // по умолчанию «400» 
							easing: "linear" // по умолчанию «swing» 
						});
					// });
					
					
					
					break;
				}
			}
			//page = pagehtml
			loadlastStats(7);
			
		}
	}
	
	function PageNewsPrev()
	{
		var page = 1;
		var pagehtml = $('.pagenews>span');
		if(pagehtml.length != 0)
		{
			var parsed = parseInt(pagehtml.html());
			if (isNaN(parsed) || parsed<2)
			{
				page = 1;
				pagehtml.html(page);
			}
			else
			{
				page = parsed;
				pagehtml.html(page-1);
			}
			//page = pagehtml
			loadlastStats(7);
		}
	}
	
	function PageNewsNext()
	{
		var page = 1;
		var pagehtml = $('.pagenews>span');
		if(pagehtml.length != 0)
		{
			var parsed = parseInt(pagehtml.html());
			if (isNaN(parsed) || parsed<1)
			{
				page = 1;
				pagehtml.html(page);
			}
			else
			{
				page = parsed;
				pagehtml.html(page+1);
			}
			//page = pagehtml
			loadlastStats(7);
		}
	}
	
	
	function loadlastStatsMain() {
		
		
		getAllOnline();
		
		
		for(var i = 0; i<9; i++)
		{
			loadlastStats(i);
		}
		
		
		if(refreshIntervalId)
		{
			clearInterval(refreshIntervalId)
		}
		refreshIntervalId = setInterval(loadlastStatsMain, winnersInterval)
	}
	
	function widthOnline(value)
	{
		
		//return parseInt(value*0.1);
		//var result = parseInt(value*0.1);
		var result = parseInt(value*0.4);
		if(result>100)
			result = 100;
		result = parseInt(result*0.9);
		return result+10;
	}
	
	function getAllOnline()
	{
		//document.getElementById("iupd1").src = 'https://forum.l2cw.ru/img/logo.png?'+Math.floor((Math.random() * 1000000) + 1);
		//document.getElementById("iupd2").src = 'https://l2cw.ru/images/logo.png?'+Math.floor((Math.random() * 1000000) + 1);
		
		var allonline = $('.onlineBlock span');
		if(allonline.length < 1)
		{
			return;
		}
		
		var allonlinesrv1 = $('.onlineReg-block-player .honline');
		var allonlinesrv2 = $('.onlineReg-block-clans .honline');
		
		var allonlinesrvS1 = $('.onlineReg-block-player .sonline');
		var allonlinesrvS2 = $('.onlineReg-block-clans .sonline');
		
		
		$.ajax({
			url: '/statapi.php?api=online&srv=1&rnd='+Math.floor((Math.random() * 1000000) + 1),
			type: 'GET',
			dataType: 'json',
			data: {
				//action: 'lastStats'
			},
			success: function(data) {
				//var number = 0;
				try {
					
					
					data.forEach(function(item)
					{
						//alert('TEST'+(parseInt(item.online)+100))
						online1 = item.online;
						var allonline = $('.onlineBlock span');
						
						if(isfirst && online1>=0 && online2>=0)
						{
							isfirst = false;
							allonline.hide();
							allonline.html(online1+online2);
							allonline.fadeIn(2000);
							
							allonlinesrv1.hide();
							allonlinesrv1.html(online1);
							allonlinesrv1.fadeIn(2000);
							allonlinesrvS1.css('max-width',widthOnline(online1)+'%')
							
							allonlinesrv2.hide();
							allonlinesrv2.html(online2);
							allonlinesrv2.fadeIn(2000);
							allonlinesrvS2.css('max-width',widthOnline(online2)+'%')
						}
						else
						if( online1>=0 && online2>=0)
						{
							if(allonline.html()!=(online1+online2))
							{
								allonline.html(online1+online2);
								allonlinesrv1.html(online1);
								allonlinesrv2.html(online2);
								allonlinesrvS1.css('max-width',widthOnline(online1)+'%')
								allonlinesrvS2.css('max-width',widthOnline(online2)+'%')
							}
						}
						
					})
					
				}
				catch(e) {
				//alert('bbbb')
				online1 = 0;
				}
			},
			error: function() {
				//alert('vvvv')
				online1 = 0;
			}
		})
		
		$.ajax({
			url: '/statapi.php?api=online&srv=2&rnd='+Math.floor((Math.random() * 1000000) + 1),
			type: 'GET',
			dataType: 'json',
			data: {
				//action: 'lastStats'
			},
			success: function(data) {
				//var number = 0;
				try {
					
					data.forEach(function(item)
					{
						//alert('TEST'+(parseInt(item.online)+100))
						online2 = item.online;
						var allonline = $('.onlineBlock span');
						
						if(isfirst && online1>=0 && online2>=0)
						{
							isfirst = false;
							allonline.hide();
							allonline.html(online1+online2);
							allonline.fadeIn(2000);
							
							allonlinesrv1.hide();
							allonlinesrv1.html(online1);
							allonlinesrv1.fadeIn(2000);
							allonlinesrvS1.css('max-width',widthOnline(online1)+'%')
							
							allonlinesrv2.hide();
							allonlinesrv2.html(online2);
							allonlinesrv2.fadeIn(2000);
							allonlinesrvS2.css('max-width',widthOnline(online2)+'%')
						}
						else
						if( online1>=0 && online2>=0)
						{
							if(allonline.html()!=(online1+online2))
							{
								allonline.html(online1+online2);
								allonlinesrv1.html(online1);
								allonlinesrv2.html(online2);
								allonlinesrvS1.css('max-width',widthOnline(online1)+'%')
								allonlinesrvS2.css('max-width',widthOnline(online2)+'%')
							}
						}
						
					})
					
				}
				catch(e) {
				//alert('bbbb')
				online2 = 0;
				}
			},
			error: function() {
				//alert('vvvv')
				online2 = 0;
			}
		})
		
		//alert(online1)
		
		//srv1
		//srv2
		
		//online = 2433;
		
		
	}
	
	
	
	function getRaceImg(id,sex)
	{
		var male = [{
						'0':'/images/race/male/human.jpg',
						'1':'/images/race/male/elf.jpg',
						'2':'/images/race/male/darkelf.jpg',
						'3':'/images/race/male/orc.jpg',
						'4':'/images/race/male/dwarf.jpg',
		}];
		
		var female = [{
						'0':'/images/race/female/human.jpg',
						'1':'/images/race/female/elf.jpg',
						'2':'/images/race/female/darkelf.jpg',
						'3':'/images/race/female/orc.jpg',
						'4':'/images/race/female/dwarf.jpg',
		}];
		
		if(sex == 1)
		{
			return female[0][id];
		}
		else
		{
			return male[0][id];
		}
	}
	
	function getClassNameImg(id)
	{
		var classname = [{
						'0':'HumanFighter',
						'1':'Warrior',
						'2':'Gladiator',
						'88':'Duelist',
						'3':'Warlord',
						'89':'Dreadnought',
						'4':'HumanKnight',
						'5':'Paladin',
						'90':'PhoenixKnight',
						'6':'DarkAvenger',
						'91':'HellKnight',
						'7':'Rogue',
						'8':'TreasureHunter',
						'93':'Adventurer',
						'9':'Hawkeye',
						'92':'Sagittarius',
						'10':'HumanMage',
						'11':'HumanWizard',
						'12':'Sorcerer',
						'94':'Archmage',
						'13':'Necromancer',
						'95':'Soultaker',
						'14':'Warlock',
						'96':'ArcanaLord',
						'15':'Cleric',
						'16':'Bishop',
						'97':'Cardinal',
						'17':'Prophet',
						'98':'Hierophant',
						'18':'ElvenFighter',
						'19':'ElvenKnight',
						'20':'TempleKnight',
						'99':'EvasTemplar',
						'21':'SwordSinger',
						'100':'SwordMuse',
						'22':'ElvenScout',
						'23':'Plainswalker',
						'101':'Windrider',
						'24':'SilverRanger',
						'102':'MoonlightSentinel',
						'25':'ElvenMage',
						'26':'ElvenWizard',
						'27':'Spellsinger',
						'103':'MysticMuse',
						'28':'ElementalSummoner',
						'104':'ElementalMaster',
						'29':'ElvenOracle',
						'30':'ElvenElder',
						'105':'EvasSaint',
						'31':'DarkFighter',
						'32':'PalusKnight',
						'33':'ShillienKnight',
						'106':'ShillienTemplar',
						'34':'Bladedancer',
						'107':'SpectralDancer',
						'35':'Assassin',
						'36':'AbyssWalker',
						'108':'GhostHunter',
						'37':'PhantomRanger',
						'109':'GhostSentinel',
						'38':'DarkMage',
						'39':'DarkWizard',
						'40':'Spellhowler',
						'110':'StormScreamer',
						'41':'PhantomSummoner',
						'111':'SpectralMaster',
						'42':'ShillienOracle',
						'43':'ShillienElder',
						'112':'ShillienSaint',
						'44':'OrcFighter',
						'45':'OrcRaider',
						'46':'Destroyer',
						'113':'Titan',
						'47':'Monk',
						'48':'Tyrant',
						'114':'GrandKhavatari',
						'49':'OrcMage',
						'50':'OrcShaman',
						'51':'Overlord',
						'115':'Dominator',
						'52':'Warcryer',
						'116':'Doomcryer',
						'53':'DwarvenFighter',
						'54':'Scavenger',
						'55':'BountyHunter',
						'117':'FortuneSeeker',
						'56':'Artisan',
						'57':'Warsmith',
						'118':'Maestro'}];
		return classname[0][id];
	}
	
	function getClassName(id)
	{
		var classname = [{
'0':'Human Fighter',
'1':'Warrior',
'2':'Gladiator',
'3':'Warlord',
'4':'Human Knight',
'5':'Paladin',
'6':'Dark Avenger',
'7':'Rogue',
'8':'Treasure Hunter',
'9':'Hawkeye',
'10':'Human Mage',
'11':'Human Wizard',
'12':'Sorcerer',
'13':'Necromancer',
'14':'Warlock',
'15':'Cleric',
'16':'Bishop',
'17':'Human Prophet',
'18':'Elf Fighter',
'19':'Elf Knight',
'20':'Temple Knight',
'21':'Swordsinger',
'22':'Scout',
'23':'Plains Walker',
'24':'Silver Ranger',
'25':'Elf Mage',
'26':'Elf Wizard',
'27':'Spellsinger',
'28':'Elemental Summoner',
'29':'Oracle',
'30':'Elder',
'31':'DE Fighter',
'32':'Palus Knight',
'33':'Shillien Knight',
'34':'Bladedancer',
'35':'Assassin',
'36':'Abyss Walker',
'37':'Phantom Ranger',
'38':'DE Mage',
'39':'DE Wizard',
'40':'Spell Howler',
'41':'Phantom Summoner',
'42':'Shillien Oracle',
'43':'Shillien Elder',
'44':'Orc Fighter',
'45':'Raider',
'46':'Destroyer',
'47':'Monk',
'48':'Tyrant',
'49':'Orc Mage',
'50':'Shaman',
'51':'Overlord',
'52':'Warcryer',
'53':'Dwarf Fighter',
'54':'Scavenger',
'55':'Bounty Hunter',
'56':'Artisan',
'57':'Warsmith',
'88':'Duelist',
'89':'DreadNought',
'90':'Phoenix Knight',
'91':'Hell Knight',
'92':'Sagittarius',
'93':'Adventurer',
'94':'Archmage',
'95':'Soultaker',
'96':'Arcana Lord',
'97':'Cardinal',
'98':'Hierophant',
'99':'Eva Templar',
'100':'Sword Muse',
'101':'Wind Rider',
'102':'Moonlight Sentinel',
'103':'Mystic Muse',
'104':'Elemental Master',
'105':'Eva Saint',
'106':'Shillien Templar',
'107':'Spectral Dancer',
'108':'Ghost Hunter',
'109':'Ghost Sentinel',
'110':'Storm Screamer',
'111':'Spectral Master',
'112':'Shillen Saint',
'113':'Titan',
'114':'Grand Khauatari',
'115':'Dominator',
'116':'Doomcryer',
'117':'Fortune Seeker',
'118':'Maestro'}];
		return classname[0][id];
	}
	
	
	function seconds_to_days_hours_mins_secs_str(seconds)
	{ 	// day, h, m and s
		var days     = Math.floor(seconds / (24*60*60));
			seconds -= days    * (24*60*60);
		var hours    = Math.floor(seconds / (60*60));
			seconds -= hours   * (60*60);
		var minutes  = Math.floor(seconds / (60));
			seconds -= minutes * (60);
		//return ((0<days)?(days+" day, "):"")+hours+"h, "+minutes+"m and "+seconds+"s";
		return ((0<days)?(days+" дня "):"")+hours+" час. "+((0>=days)?(minutes+"мин."):"");
	}
	
	function formatDate(date) {
		var dd = date.getDate();
		if (dd < 10) dd = '0' + dd;
		
		var mm = date.getMonth() + 1;
		if (mm < 10) mm = '0' + mm;
		
		var yy = date.getFullYear() % 100;
		if (yy < 10) yy = '0' + yy;
		
		/*
		
		var hour = date.getHours();
		if (hour < 10) hour = '0' + hour;

		var minutes = date.getMinutes();
		if (minutes < 10) minutes = '0' + minutes;
		
		return dd + '.' + mm + '.' + yy + " "+hour+":"+minutes;
		*/
		return dd + '.' + mm + '.' + yy;
	}
	
	function formatDateAll(date) {
		var dd = date.getDate();
		if (dd < 10) dd = '0' + dd;
		
		var mm = date.getMonth() + 1;
		if (mm < 10) mm = '0' + mm;
		
		var yy = date.getFullYear() % 100;
		if (yy < 10) yy = '0' + yy;
		

		
		var hour = date.getHours();
		if (hour < 10) hour = '0' + hour;

		var minutes = date.getMinutes();
		if (minutes < 10) minutes = '0' + minutes;
		
		return dd + '.' + mm + '.' + yy + " "+hour+":"+minutes;
		
		//return dd + '.' + mm + '.' + yy;
	}
	
	function GetColorLevel(level)
	{
		var result = '';
		
		if(level>=76)
		{
			result = '<font class="color-yellow">'+level+'</font>';
		}
		else
		if(level>=61)
		{
			result = '<font class="color-silver">'+level+'</font>';
		}
		else
		if(level>=52)
		{
			result = '<font class="color-red2">'+level+'</font>';
		}
		else
		if(level>=40)
		{
			result = '<font class="color-green">'+level+'</font>';
		}
		else
		if(level>=20)
		{
			result = '<font class="color-blue">'+level+'</font>';
		}
		else
		{
			result = '<font class="color-white">'+level+'</font>';
		}
		
		return result;
	}
	
	
	function GetColorLevel2(level)
	{
		var result = '';
		/*
		if(level>=76)
		{
			result = '<font class="color-yellow">'+level+'</font>';
		}
		else
		if(level>=61)
		{
			result = '<font class="color-silver">'+level+'</font>';
		}
		else
		if(level>=52)
		{
			result = '<font class="color-red2">'+level+'</font>';
		}
		else
		if(level>=40)
		{
			result = '<font class="color-green">'+level+'</font>';
		}
		else
		if(level>=20)
		{
			result = '<font class="color-blue">'+level+'</font>';
		}
		else
		{
			result = '<font class="color-white">'+level+'</font>';
		}*/
		result = '<font class="color-silver">'+level+'</font>';
		
		return result;
	}
	
	function escapeHtml(text) {
		var div = document.createElement('div');
		div.innerText = text;
		return div.innerHTML;
	}
	
	function getCastleName(id) {
		var castleName
		switch (id)
		{
			case "undefined":
				castleName = 'Giran';
				break;
			case "1":
				castleName = 'Gludio';
				break;
			case "2":
				castleName = 'Dion';
				break;
			case "3":
				castleName = 'Giran';
				break;
			case "4":
				castleName = 'Oren';
				break;
			case "5":
				castleName = 'Aden';
				break;
			case "6":
				castleName = 'Innadril';
				break;
			case "7":
				castleName = 'Goddard';
				break;
			case "8":
				castleName = 'Rune';
				break;
			case "9":
				castleName = 'Schuttgart';
				break;
			default:
				castleName = '<font color="#333333">Нет Замка</font>';
				break;
		}
		return castleName;
	}
	
	function getRnd(min, max) 
	{
		return Math.floor(Math.random() * (max - min + 1) ) + min;
	}
	
	function loadlastStats(blockid) {
		//if (openingCase) return;

		var textstat
		//var colspan_type
		var statsheader = $('.statsheader'+blockid) //1
		if(statsheader.length < 1)
		{
			return;
		}

		
		//colspan_type = 1
		
		shopScript[0] = '/statistic/pvp/ajax';
		shopScript[1] = '/statapi.php?api=toppk&srv=1&rnd='+Math.floor((Math.random() * 1000000) + 1);
		shopScript[2] = '/statistic/pvp/ajax';
		shopScript[3] = '/statapi.php?api=toppk&srv=2&rnd='+Math.floor((Math.random() * 1000000) + 1);
		shopScript[4] = '/forumapi.php?api=forum&rnd='+Math.floor((Math.random() * 1000000) + 1);
		shopScript[5] = '/qiwiapi.php?api=qiwi&rnd='+Math.floor((Math.random() * 1000000) + 1);
		
		var serverid = 1;
		var serverstat = $('.serverstat>span');
		if (serverstat.length != 0 && serverstat.html() == 'x1200')
		{
			serverid = 2;
		}
		
		shopScript[6] = '/statapi.php?api=characters&srv='+serverid+'&rnd='+Math.floor((Math.random() * 1000000) + 1);
		shopScript[7] = '/statapi.php?api=news&rnd='+Math.floor((Math.random() * 1000000) + 1);
		
		shopScript[8] = '/teleapi.php?api=tele&rnd='+Math.floor((Math.random() * 1000000) + 1);
		
		var thead = '';

		var loading;
		var noting;
		
		var toptitle = $('.topTitle');

		if(blockid == 5)
		{
			if (statsheader.length != 0 )
			{
				if(statsheader.find(".tbbody").length == 0)
				{
					var textstat2 = $('<tbody id="lastStats'+blockid+'" class="tbbody"></tbody>') //1
					statsheader.append(textstat2)
					textstat2.fadeIn(0)
				}
			}
			loading = $('<tr><td colspan="5" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>Loading...</center></font></div></td></tr>')
			noting = $('<tr><td colspan="5" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>No Information...</center></font></div></td></tr>')
		}
		else
		if(blockid == 6)
		{
			if (statsheader.length != 0 )
			{
				if(statsheader.find(".tbbody").length == 0)
				{
					var textstat2 = $('<tbody id="lastStats'+blockid+'" class="tbbody"></tbody>') //1
					statsheader.append(textstat2)
					textstat2.fadeIn(0)
				}
			}
			loading = $('<tr><td colspan="8" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>Loading...</center></font></div></td></tr>')
			noting = $('<tr><td colspan="8" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>No Information...</center></font></div></td></tr>')
			
			var page = 1;
			var pagehtml = $('.pagestat>span');
			if(pagehtml.length != 0)
			{
				var parsed = parseInt(pagehtml.html());
				if (isNaN(parsed))
				{
					page = 1;
				}
				else
				{
					page = parsed;
				}
				//page = pagehtml
			}
			
			//var thread = statsheader.find("thead");
			
			
			
			if(toptitle.length != 0 && toptitle.html() == 'Top Игроков')
			{
				thead = ('<tr><td width="25px">№</td><td>Ник</td><td>Lvl</td><td>Профессия</td><td>Клан</td><td>PvP/PK</td><td>Статус</td><td>Время в игре</td></tr>');
				shopScript[6] = '/statapi.php?api=characters&page='+page+'&srv='+serverid+'&rnd='+Math.floor((Math.random() * 1000000) + 1);
			}
			else
			if(toptitle.length != 0 && toptitle.html() == 'Top PVP')
			{
				thead = ('<tr><td width="25px">№</td><td>Ник</td><td>Lvl</td><td>Профессия</td><td>Клан</td><td>PvP/PK</td><td>Статус</td><td>Время в игре</td></tr>');
				shopScript[6] = '/statistic/pvp/ajax;
			}
			else
			if(toptitle.length != 0 && toptitle.html() == 'Top PK')
			{
				thead = ('<tr><td width="25px">№</td><td>Ник</td><td>Lvl</td><td>Профессия</td><td>Клан</td><td>PvP/PK</td><td>Статус</td><td>Время в игре</td></tr>');
				shopScript[6] = '/statapi.php?api=pk&page='+page+'&srv='+serverid+'&rnd='+Math.floor((Math.random() * 1000000) + 1);
			}
			else
			if(toptitle.length != 0 && toptitle.html() == 'Кланы')
			{
				loading = $('<tr><td colspan="8" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>Loading...</center></font></div></td></tr>')
				noting = $('<tr><td colspan="8" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>No Information...</center></font></div></td></tr>')
				thead = ('<tr><td width="25px">№</td><td>Лидер</td><td>Клан</td><td>Lvl</td><td>Замок</td><td>Игроков</td><td>Репутация</td><td>Альянс</td></tr>');
				
				shopScript[6] = '/statapi.php?api=clans&page='+page+'&srv='+serverid+'&rnd='+Math.floor((Math.random() * 1000000) + 1);
			}
			else
			if(toptitle.length != 0 && toptitle.html() == 'Замки')
			{
				loading = $('<tr><td colspan="2" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>Loading...</center></font></div></td></tr>')
				noting = $('<tr><td colspan="2" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>No Information...</center></font></div></td></tr>')
				thead = ('<tr><td colspan="2" style="text-align: center;padding: 20px 35px 20px 35px;">Замки</td></tr>');
				shopScript[6] = '/statapi.php?api=castles&page='+page+'&srv='+serverid+'&rnd='+Math.floor((Math.random() * 1000000) + 1);
			}
			else
			if(toptitle.length != 0 && toptitle.html() == 'Информация')
			{
				thead = ('<tr><td width="25px">№</td><td>Ник</td><td>Lvl</td><td>Профессия</td><td>Клан</td><td>PvP/PK</td><td>Статус</td><td>Время в игре</td></tr>');
				shopScript[6] = '/statapi.php?api=info&page='+page+'&srv='+serverid+'&rnd='+Math.floor((Math.random() * 1000000) + 1);
			}
			else
			{
				thead = ('<tr><td width="25px">№</td><td>Ник</td><td>Lvl</td><td>Профессия</td><td>Клан</td><td>PvP/PK</td><td>Статус</td><td>Время в игре</td></tr>');
				shopScript[6] = '/statapi.php?api=characters&page='+page+'&srv='+serverid+'&rnd='+Math.floor((Math.random() * 1000000) + 1);
			}
			
			
		}
		else
		if(blockid == 7)
		{
			if (statsheader.length != 0 )
			{
				if(statsheader.find(".tbbody").length == 0)
				{
					var textstat2 = $('<div id="lastStats'+blockid+'" class="tbbody"></div>') //1
					statsheader.append(textstat2)
					textstat2.fadeIn(0)
				}
			}
			
			loading = $('<div class="trRowB"  style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>Loading...</center></font></div></div>')
			noting = $('<div class="trRowB"   style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>No information...</center></font></div></div>')
			
			
			var page = 1;
			var pagehtml = $('.pagenews>span');
			if(pagehtml.length != 0)
			{
				var parsed = parseInt(pagehtml.html());
				if (isNaN(parsed))
				{
					page = 1;
				}
				else
				{
					page = parsed;
				}
				//page = pagehtml
			}
			shopScript[7] = '/statapi.php?api=news&page='+page+'&rnd='+Math.floor((Math.random() * 1000000) + 1);
			if(window.location.hash == '#newsall')
			{
				shopScript[7] = '/statapi.php?api=newsall&page='+page+'&rnd='+Math.floor((Math.random() * 1000000) + 1);
			}
		}
		else
		if(blockid == 8)
		{
			if (statsheader.length != 0 )
			{
				if(statsheader.find(".tbbody").length == 0)
				{
					var textstat2 = $('<tbody id="lastStats'+blockid+'" class="tbbody"></tbody>') //1
					statsheader.append(textstat2)
					textstat2.fadeIn(0)
				}
			}
			loading = $('<tr><td colspan="5" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>Loading...</center></font></div></td></tr>')
			noting = $('<tr><td colspan="5" class="trRowB" style="padding: 20px 35px 20px 35px;"><div ><font size="4"><center>No Information...</center></font></div></td></tr>')
		}
		else //blockid == 4
		{
			if (statsheader.length != 0 )
			{
				if(statsheader.find(".tbbody").length == 0)
				{
					var textstat2 = $('<div id="lastStats'+blockid+'" class="tbbody"></div>') //1
					statsheader.append(textstat2)
					textstat2.fadeIn(0)
				}
			}
			//hz
			loading = $('<div class="trRowB" style="padding: 20px 35px 20px 35px;" ><div ><font size="4"><center>Loading...</center></font></div></div>')
			noting = $('<div class="trRowB" style="padding: 20px 35px 20px 35px;" ><div ><font size="4"><center>No information...</center></font></div></div>')
		}
		
		
		var lastStats = $('#lastStats'+blockid) //1
		
		if (showLoading[blockid])
		{
			if (lastStats.find('.item0').length != 0)
			{
				lastStats.find('.item0').remove()
			}
			loading.hide().addClass('item0')
			lastStats.append(loading)
			loading.fadeIn(1000)
			showLoading[blockid] = false
		}
		
		//JSON.parse
		var deletestats = true
		if(shopScript[blockid] != 'NONE')
		{
			
			$.ajax
			({
				url: shopScript[blockid],
				type: 'GET',
				dataType: 'json',
				data: {
					action: 'lastStats'+blockid
				},
				success: function(data) {
					var number = 0;
					try {
						if(blockid == 6)
						{
							if (statsheader.length != 0 )
							{
								//var thread_hrml = statsheader.find("thead");
								var thead_html = statsheader.find("thead");
								//alert(thread);
								if(thead_html.length != 0)
								{
									//alert(thread);
									thead_html.html(thead);
								}
							}
						}
						
						
						data.forEach(function(item)
						{
							if (item)
							{
								number++;
								if(number % 2)
									trRow = 'trRowA1'
								else
									trRow = 'trRowB1'

								var el
								if(blockid == 0 || blockid == 1 || blockid == 2 || blockid == 3)
								{
									
									var srvid = 1;
									if(blockid == 2 || blockid == 3)
									{
										srvid = 2;
									}
									
									if(item.ally_crest_id > 0)
										allyImg = '<img class="allycrest" src="//l2cw.ru/crests/'+srvid+'/AllyCrest_'+item.ally_crest_id+'.gif" height="14" width="8" align="middle" alt="" style="vertical-align: middle;">'
									else
										allyImg = ''
								
									if(item.crest_id > 0)
										clanImg = '<img class="clancrest" src="//l2cw.ru/crests/'+srvid+'/Crest_'+item.crest_id+'.gif" height="14" width="18" align="middle" alt="" style="vertical-align: middle;">'
									else
										clanImg = ''
									
									
									var clanname = escapeHtml(item.clan_name)
									//if(clanname.toUpperCase() === ''.toUpperCase())
									if(clanname.toUpperCase() === ''.toUpperCase())
										clanname = '<font color="#333333">Нет Клана</font>'
									
									var sex = 'Мужской';
									if(item.sex == 1)
									{
										sex = 'Женский';
									}

									el = $('<div class="tableBlock-content oflo '+trRow+'">'+
										'<div class="tableBlock-conten_number">'+number+'</div>'+
										'<div class="tableBlock-conten_name"><img src="'+getRaceImg(item.race,item.sex)+'" alt=""> <a href="javascript:void(0)">'+allyImg+clanImg+''+escapeHtml(item.char_name)+''+
											'<div class="tablePopup">'+
												'<span class="tablePopup-title">'+allyImg+clanImg+'<b>'+escapeHtml(item.char_name)+'</b>'+'</span>'+
												'<div class="tablePopup-ava"><img src="'+getRaceImg(item.race,item.sex)+'" alt=""></div>'+
												//'<div class="tablePopup-block">'+
													//'<span>Иконка класса:</span> <span><img class="classicon" src="images/'+getClassNameImg(item.classid)+'.png"></span>'+
												//'</div>'+
												'<div class="tablePopup-block">'+
													'<span>Клан:</span> <span>'+allyImg+clanImg+clanname+'</span>'+
												'</div>'+
												'<div class="tablePopup-block">'+
													'<span>Уровень:</span> <span>'+GetColorLevel(item.level)+'</span>'+
												'</div>'+
												'<div class="tablePopup-block">'+
													'<span>Класс:</span> <span>'+getClassName(item.base_class)+'</span>'+
												'</div>'+
												((item.base_class != item.classid)?
													'<div class="tablePopup-block">'+
														'<span>Сабкласс:</span> <span>'+getClassName(item.classid)+'</span>'+
													'</div>':'')+

												'<div class="tablePopup-block">'+
													'<span>В игре:</span> <span>'+seconds_to_days_hours_mins_secs_str(item.onlinetime)+'</span>'+
												'</div>'+
												'<div class="tablePopup-block">'+
													'<span>Пол:</span> <span>'+sex+'</span>'+
												'</div>'+
											'</div>'+
										'</a></div>'+
										'<div class="tableBlock-conten_lvl"><span>'+GetColorLevel(item.level)+'</span></div>'+
										'<div class="tableBlock-conten_scr"><span class="pvp color-purple">'+item.pvpkills+'</span><font color="#696868">/</font><span class="pk color-red">'+item.pkkills+'</span></div>'+
									'</div>')
								}
								else
								if(blockid == 4 )
								{
									
									var photo = '';
									if(item != null &&  item.pp_main_photo != null && item.pp_main_photo != '' && (item.pp_main_photo.endsWith('.jpg') || item.pp_main_photo.endsWith('.png') || item.pp_main_photo.endsWith('.gif') || item.pp_main_photo.endsWith('.bmp')) )
									{
										photo = forum+'uploads/'+item.pp_main_photo;
									}
									else
									{
										photo = '/images/default_large.png?1';
										
									}
									//var formatted = $.datepicker.formatDate("M d, yy", new Date("2014-07-08T09:02:21.377"));
									//var formatted = new Date(item.last_post*1000).toDateString();
									var formatted = formatDate(new Date(item.last_post*1000));
									
									var admgrp = '';
									if(item.member_group_id == 4)
									{
										admgrp = 'class="admin-group"';
									}
									
									el = $('<div class="forumBlock oflo '+trRow+'">'+
												'<div class="forumBlock-ava">'+
													'<img src="'+photo+'" alt="">'+
												'</div>'+
												'<div class="forumBlock-text">'+
													'<a href="'+forum+'index.php?showtopic='+item.tid+'" class="forumBlock-text_link" target="_blank">'+item.title+'</a>'+
													'<div class="forumBlock-text_info">'+
														'<span class="forumBlock-text_info-nick">by <a '+admgrp+' href="'+forum+'index.php?showuser='+item.last_poster_id+'" title="'+item.last_poster_name+'" target="_blank">'+item.last_poster_name+'</a></span>'+
														'<span class="forumBlock-text_info-date">'+formatted+' | <span class="forumBlock-text_info-comments">'+item.posts+'</span></span>'+
														//'<span class="forumBlock-text_info-comments">'+item.posts+'</span>'+
													'</div>'+
												'</div>'+
											'</div>')
											
									//console.log('test '+item.posts);
								}
								else
								if(blockid == 5 )
								{
									
									
									//var formatted = $.datepicker.formatDate("M d, yy", new Date("2014-07-08T09:02:21.377"));
									//var formatted = new Date(item.last_post*1000).toDateString();
									//var formatted = formatDate(new Date(item.last_post*1000));
									
									el = $('<tr><td>'+item.qiwipayId+'</td><td style="text-align:left">'+item.system+'</td><td style="text-align:right">'+item.sum+'₽</td><td style="text-align:right">'+(item.itemsCount/100)+'₽</td><td style="text-align:right">'+item.dateComplete+'</td></tr>')
									
									
								}
								else
								if(blockid == 6 )
								{
									if(toptitle.length != 0 && toptitle.html() == 'Кланы')
									{
										var srvid = serverid;
										if(item.ally_crest_id > 0)
											allyImg = '<img class="allycrest" src="//l2cw.ru/crests/'+srvid+'/AllyCrest_'+item.ally_crest_id+'.gif" height="14" width="8" align="middle" alt="" style="vertical-align: middle;">'
										else
											allyImg = ''
										if(item.crest_id > 0)
											clanImg = '<img class="clancrest" src="//l2cw.ru/crests/'+srvid+'/Crest_'+item.crest_id+'.gif" height="14" width="18" align="middle" alt="" style="vertical-align: middle;">'
										else
											clanImg = ''
										var clanname = escapeHtml(item.clan_name)
										if(clanname.toUpperCase() === ''.toUpperCase())
											clanname = '<font color="#333333">Нет Клана</font>'
										
										var allyname = escapeHtml(item.ally_name)
										if(allyname.toUpperCase() === ''.toUpperCase())
											allyname = '<font color="#333333">Нет Альянса</font>'
										
										var sex = 'Мужской';
										if(item.sex == 1)
										{
											sex = 'Женский';
										}
										var online = '';
										if(item.online == 1)
										{
											online = '[ online ]';
										}
										
										el = $('<tr class="tableBlock-conten_name1 oflo '+trRow+'">'+
												'<td>'+item.number+'</td>'+
												'<td><a href="javascript:void(0)">'+allyImg+clanImg+' '+escapeHtml(item.char_name)+
												'<div class="tablePopup1">'+
													'<span class="tablePopup1-title">'+allyImg+clanImg+'<b>'+escapeHtml(item.char_name)+'</b>'+'</span>'+
													'<div class="tablePopup1-ava"><img src="'+getRaceImg(item.race,item.sex)+'" alt=""></div>'+
													//'<div class="tablePopup-block">'+
														//'<span>Иконка класса:</span> <span><img class="classicon" src="images/'+getClassNameImg(item.classid)+'.png"></span>'+
													//'</div>'+
													'<div class="tablePopup1-block">'+
														'<span>Клан:</span> <span>'+allyImg+clanImg+clanname+'</span>'+
													'</div>'+
													'<div class="tablePopup1-block">'+
														'<span>Уровень:</span> <span>'+GetColorLevel(item.level)+'</span>'+
													'</div>'+
													'<div class="tablePopup-block">'+
														'<span>Класс:</span> <span>'+getClassName(item.base_class)+'</span>'+
													'</div>'+
													((item.base_class != item.classid)?
													'<div class="tablePopup-block">'+
														'<span>Сабкласс:</span> <span>'+getClassName(item.classid)+'</span>'+
													'</div>':'')+
													'<div class="tablePopup1-block">'+
														'<span>В игре:</span> <span>'+seconds_to_days_hours_mins_secs_str(item.onlinetime)+'</span>'+
													'</div>'+
													'<div class="tablePopup1-block">'+
														'<span>Пол:</span> <span>'+sex+'</span>'+
													'</div>'+
												'</div>'+
												'</a></td>'+
												
												'<td style="color:#696868;">'+clanImg+clanname+'</td>'+
												'<td>'+GetColorLevel2(item.clan_level)+'</td>'+
												
												'<td>'+getCastleName(item.hasCastle+'')+'</td>'+
												'<td>'+GetColorLevel2(item.count)+'</td>'+
												'<td>'+item.reputation_score+'</td>'+
												'<td>'+allyImg+allyname+'</td>'+
												
												
												
												
											'</tr>')
									}
									else
									if(toptitle.length != 0 && toptitle.html() == 'Замки')
									{
										
										var siegeDate = formatDateAll(new Date(parseInt(item.siegeDate)));
										var lider = escapeHtml(item.clan_name)
										
										if(item.id == undefined)
										{
											item.id = "1";
										}
										
										el = $(
											'<tr class="noneon oflo '+trRow+'" style="background-image:none;">'+
												'<td class="l2left">'+
													'<img src="/images/castles/'+item.id+'.jpg" width="164px" height="123px" border="0">'+
												'</td>'+
												'<td class="l2right" style="text-align: right;">'+
													'<strong>'+escapeHtml(item.name)+' Castle</strong><br>'+
													'<small>Налог: '+item.taxPercent+'%, '+siegeDate+'</small><br><br>'+
													((lider.length != 0)?'Владелец: <b>'+lider+'</b><br><br>':'Владельца нету')+
									
													//'Владелец: <b>'+allyImg+clanImg+escapeHtml(item.clan_name)+'</b><br><br>'+
													//'Защитники: '+escapeHtml(Defenders)+'<br>'+
													//'Атакующие: '+escapeHtml(Attackers)+'<br>'+
												'</td>'+
											'</tr>'
										)
										//alert(el.text());
									}
									else
									{
										var srvid = serverid;
										if(item.ally_crest_id > 0)
											allyImg = '<img class="allycrest" src="//l2cw.ru/crests/'+srvid+'/AllyCrest_'+item.ally_crest_id+'.gif" height="14" width="8" align="middle" alt="" style="vertical-align: middle;">'
										else
											allyImg = ''
										if(item.crest_id > 0)
											clanImg = '<img class="clancrest" src="//l2cw.ru/crests/'+srvid+'/Crest_'+item.crest_id+'.gif" height="14" width="18" align="middle" alt="" style="vertical-align: middle;">'
										else
											clanImg = ''
										var clanname = escapeHtml(item.clan_name)
										if(clanname.toUpperCase() === ''.toUpperCase())
											clanname = '<font color="#333333">Нет Клана</font>'
										var sex = 'Мужской';
										if(item.sex == 1)
										{
											sex = 'Женский';
										}
	
										var online = '';
										if(item.online == 1)
										{
											online = '[ online ]';
										}
										else
										if(item.online == 2)
										{
											online = '<font style="color: #ffb23f;text-shadow: 0px 0px 8px #e74b00;">[ trade ]</font>';
										}
										else
										if(item.online == 3)
										{
											online = '<font style="color:#999;text-shadow: 0px 0px 8px #888;">[ afk ]</font>';
										}
										
										el = $('<tr class="tableBlock-conten_name1 oflo '+trRow+'">'+
												'<td>'+item.number+'</td>'+
												'<td><a href="javascript:void(0)">'+allyImg+clanImg+' '+escapeHtml(item.char_name)+
												
												'<div class="tablePopup1">'+
													'<span class="tablePopup1-title">'+allyImg+clanImg+'<b>'+escapeHtml(item.char_name)+'</b>'+'</span>'+
													'<div class="tablePopup1-ava"><img src="'+getRaceImg(item.race,item.sex)+'" alt=""></div>'+
													//'<div class="tablePopup-block">'+
														//'<span>Иконка класса:</span> <span><img class="classicon" src="images/'+getClassNameImg(item.classid)+'.png"></span>'+
													//'</div>'+
													'<div class="tablePopup1-block">'+
														'<span>Клан:</span> <span>'+allyImg+clanImg+clanname+'</span>'+
													'</div>'+
													'<div class="tablePopup1-block">'+
														'<span>Уровень:</span> <span>'+GetColorLevel(item.level)+'</span>'+
													'</div>'+
													'<div class="tablePopup-block">'+
														'<span>Класс:</span> <span>'+getClassName(item.base_class)+'</span>'+
													'</div>'+
													((item.base_class != item.classid)?
													'<div class="tablePopup-block">'+
														'<span>Сабкласс:</span> <span>'+getClassName(item.classid)+'</span>'+
													'</div>':'')+
													'<div class="tablePopup1-block">'+
														'<span>В игре:</span> <span>'+seconds_to_days_hours_mins_secs_str(item.onlinetime)+'</span>'+
													'</div>'+
													'<div class="tablePopup1-block">'+
														'<span>Пол:</span> <span>'+sex+'</span>'+
													'</div>'+
												'</div>'+
												'</a></td>'+
												'<td>'+GetColorLevel(item.level)+'</td>'+
												'<td><img src="'+getRaceImg(item.race,item.sex)+'" alt="">'+getClassName(item.classid)+'</td>'+
												'<td>'+allyImg+clanImg+clanname+'</td>'+
												'<td style="text-align: right;"><span class="pvp color-purple">'+item.pvpkills+'</span><font color="#696868">/</font><span class="pk color-red">'+item.pkkills+'</span></td>'+
												'<td>'+online+'</td>'+
												'<td>'+seconds_to_days_hours_mins_secs_str(item.onlinetime)+'</td>'+
											'</tr>')
									}
									
									
									
								}
								else
								if(blockid == 7)
								{
									//var res = String(item.html).replaceAll(/(\r\n)/gm, '\n');
									//el = $(res)
									el = $(item.html)
									//console.log(item.html)
									//console.log(el.text())
								}
								else
								if(blockid == 8 )
								{
									
									
									//var formatted = $.datepicker.formatDate("M d, yy", new Date("2014-07-08T09:02:21.377"));
									//var formatted = new Date(item.last_post*1000).toDateString();
									//var formatted = formatDate(new Date(item.last_post*1000));
									
									if(item.status>0)
									{
										status_tele = '<font class="font_good">[Выдано]</font>';
									}
									else
									{
										status_tele = '<font class="font_bad">[Ожидает]</font>';
									}
									
									el = $('<tr><td>'+item.id+'</td><td style="text-align:left"><b><font color="#00AA00">'+item.code.toUpperCase()+'</font></b></td><td style="text-align:left">'+item.server+'</td><td style="text-align:right">'+item.curtime+'</td><td style="text-align:right">'+status_tele+'</td></tr>')
									
									
								}
								
								

								if (lastStats.find('.item' + number).length != 0 && lastStats.find('.item' + number).text() == el.text())
								{
									/*lastStats.find('.item' + number).remove()
									el.hide().addClass('item'+number)
									lastStats.append(el)
									//el.fadeIn(0);
									el.show();*/
									
								}
								else
								{
									/*lastStats.find('.item' + number).remove()
									el.hide().addClass('item'+ number)
									lastStats.append(el)
									el.fadeIn(1000)*/
									
									var itemrow = lastStats.find('.item' + number);
									if(itemrow.length == 0)
									{
										lastStats.find('.item' + number).remove()
										el.hide().addClass('item'+ number)
										lastStats.append(el)
										el.fadeIn(1000)
									}
									else
									{
										if(blockid == 7)
										{
											//alert("test none ==");
											//console.log(convertToHex(lastStats.find('.item' + number).text()))
											//console.log(convertToHex(el.text()))
											
											//console.log((lastStats.find('.item' + number).text()))
											//console.log((el.text()))
										}
										el.hide().addClass('item'+ number)
										itemrow.hide();
										itemrow.attr('class',el.attr('class'));
										itemrow.attr('style',el.attr('style'));
										itemrow.html(el.html());
										itemrow.fadeIn(1000)
										el.fadeIn(1000)
									}
									
								}
							}
							deletestats = false
						})
						
						var count = number;
						while(true)
						{
							
							number++;
							if (lastStats.find('.item'+number).length != 0)
							{
								lastStats.find('.item'+number).remove()
							}
							else
							{
								break;
							}
							
						}
						
						if (lastStats.find('.item0').length != 0)
						{
							lastStats.find('.item0').remove()
						}
						if(count<=0)
						{
							noting.hide().addClass('item0')
							lastStats.append(noting)
							noting.fadeIn(1000)
							showLoading = true
						}
						else
						{
							showLoading = false
						}
					}
					catch(e) {
								console.log(e);
								//alert('bbb')
								if (lastStats.find(".oflo").length != 0)
								{
									lastStats.find(".oflo").remove()
								}
								if (lastStats.find('.item0').length != 0)
								{
									lastStats.find('.item0').remove()
								}
								noting.hide().addClass('item0')
								lastStats.append(noting)
								noting.fadeIn(1000)
								showLoading = true
					}
				},
				error: function() {
					//alert('vvv')
				}
			})
			
			
			
			
		}
		else
		{
			if (lastStats.find(".oflo").length != 0)
			{
				lastStats.find(".oflo").remove()
			}
			if (lastStats.find('.item0').length != 0)
			{
				lastStats.find('.item0').remove()
			}

			noting.hide().addClass('item0')

			lastStats.append(noting)
			noting.fadeIn(1000)
			showLoading = true

		}
		
		//if(refreshIntervalId)
		//{
			//clearInterval(refreshIntervalId)
		//}
		//refreshIntervalId = setInterval(loadlastStats, winnersInterval)
	}

//})

